import numpy
from sklearn import datasets, svm
from scipy import ndimage
digits = datasets.load_digits()


def whiteBoardOCR(image):
    new_image = numpy.ndarray(shape=(20, 20))
    for lidx, line in enumerate(image):
        for pidx, pixel in enumerate(line):
            if pixel == '.':
                cur_num = 0
            else:
                cur_num = 15
            new_image[lidx][pidx] = cur_num

    print(new_image)
    new_image = numpy.reshape(new_image, 400)
    print(new_image)
    res_new_image = ndimage.zoom(new_image, 64 / 400, order=1)

    print(res_new_image)
    # res_new_image = misc.imresize(new_image, (8,8))

    clf = svm.SVC(gamma=0.001, probability=True)
    clf.fit(digits.data[:1700], digits.target[:1700])

    res_new_image = res_new_image.reshape(1, -1)
    pred = clf.predict(res_new_image)

    return pred


# image= ["....................",
#         "........###.........",
#         ".....####.####......",
#         "....##.......##.....",
#         "...##.........##....",
#         "...#...........#....",
#         "...............##...",
#         "................#...",
#         "...............##...",
#         "...............#....",
#         "..............##....",
#         "............##......",
#         "...........##.......",
#         ".........##.........",
#         "..########..........",
#         "..#..#####.......##.",
#         "..####....########..",
#         "..##................",
#         "....................",
#         "...................."]
#
# image= ["....................",
#  "....................",
#  ".........#..........",
#  "........##..........",
#  ".......#............",
#  "......##............",
#  "......#.............",
#  ".....##.............",
#  "....##..............",
#  "....#...............",
#  "...##.....#.........",
#  "..##......#.........",
#  "..#.......#.........",
#  ".##############.....",
#  "..........#.........",
#  ".........##.........",
#  ".........#..........",
#  ".........#..........",
#  "....................",
#  "...................."]


# image = ["....................",
#          "....................",
#          "..............##....",
#          ".....#########......",
#          ".....#..............",
#          ".....#..............",
#          "....#...............",
#          "....#...............",
#          "....#...............",
#          "....########........",
#          "............##......",
#          "..............#.....",
#          "..............##....",
#          "...............#....",
#          "..............#.....",
#          "....#.......##......",
#          "....#####.##........",
#          "....................",
#          "....................",
#          "...................."]


image= ["....................",
 "....................",
 "....................",
 "...###############..",
 "..##............##..",
 "...............##...",
 "...............#....",
 "..............#.....",
 ".............##.....",
 ".............#......",
 "............##......",
 "............#.......",
 "........#########...",
 "........#..#........",
 "..........##........",
 "..........#.........",
 ".........#..........",
 "........##..........",
 "........#...........",
 ".......##..........."]

print(whiteBoardOCR(image))
